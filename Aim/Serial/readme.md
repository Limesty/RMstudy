# 2023-电控算法接口

2023年2月4日

v0.1 更新2023赛季控制方式，实现NUC向单片机的单向控制数据传输。

## 接口函数概览

当前提供的接口函数为`send_control`

```c
bool send_control(
    fp32 pitch,	// pitch轴目标偏移角度，弧度制，向左偏为正
    fp32 yaw,	// yaw轴目标偏移角度，弧度制，向上偏为正
    fp32 x,		// x方向速度（前进），单位m/s
    fp32 y,		// y方向速度（左移），单位m/s
    fp32 w,		// 小陀螺自转角速度 ，单位rad/s
    uint32_t shoot,	// 为1时表示立刻发射，否则设置为0
    uint32_t found_armor	// 为1时表示在当前画面中找到了需要瞄准的装甲板，否则设置为0
);
```

调用后，会控制机器人的云台、底盘和发射。

## 约定

本接口适用于步兵和哨兵。由操作手决定机器人的控制模式

| 类型             | 按键 | 遥控器右拨杆 | 功能                                      | NUC发送的有效数据                                            |
| ---------------- | ---- | ------------ | ----------------------------------------- | ------------------------------------------------------------ |
| 普通车（半自动） | C    | 上           | 操作手控制发射、底盘、云台，按下z启动自瞄 | （自瞄模式）pitch表示目标pitch偏移，yaw表示目标yaw偏移。found_armor表示画面中寻找到了装甲板并正在追踪（此信息用于辅助自瞄模式云台自动控制和手动控制的切换）。x,y,w,shoot无效 |
| 小陀螺（半自动） | V    | 中           | 操作手控制发射、底盘、云台，按下z启动自瞄 | 同上                                                         |
| 全自动           | B    | 下           | NUC接管发射、底盘、云台                   | pitch表示目标pitch偏移，yaw表示目标yaw偏移。shoot表示立刻发射弹丸。x,y,w,分别表示底盘运动的前进、左移、旋转角速度。found_armor无效。 |

### 步兵自瞄模式

见表格

### 哨兵全自动模式

见表格

## 使用方法

主函数调用方式参考`main.cpp`，调用后，控制机器人云台、底盘、发射机构运动。

例如如下方式发送，需要包含头文件`commu_proto.h`

```C
#include "commu_proto.h"
#include <unistd.h>
int main()
{
    while(1)
    {
		send_control(1.3,3.1,1.0,1.0,1.0,1,1);
        usleep(10000);  // 10ms
    }
    return 0;
}
```

编译方式参考`run.sh`

Linux下运行，命令行需要加`sudo`

## 参考

底层串口设置和发送源码（以下几个文件）来自于上海交通大学2019年自瞄代码工程。

```
.
├── log.h
├── serial.cpp
├── serial.h
└── systime.h
```

